<%@ Page Language="C#" AutoEventWireup="true" CodeFile="file-uploader.aspx.cs" Inherits="ckHelper_uploader_file_uploader" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title>Media uploader</title>
    <link href="styles/uploader.css" rel="stylesheet" type="text/css" />
    <script src="scripts/jquery-1.8.3.min.js" type="text/javascript"></script>
    <script src="scripts/plupload.full.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {
            var uploader = new plupload.Uploader({
                browse_button: 'pickfiles',                         // Browse button
                container: document.getElementById('container'),    // Element which will contain plupload stucture
                url: 'upload.ashx',
                flash_swf_url: 'scripts/Moxie.swf',
                silverlight_xap_url: 'scripts/Moxie.xap',
                file_data_name: "async-upload",
                chunk_size: '1mb',
                filters: {
                    max_file_size: '2097152b',
                    mime_types: [
                        { title: "Image files", extensions: "jpg,gif,png" },
                        { title: "Zip files", extensions: "zip" }
                    ]
                },
                unique_names: true,
                init: {
                    PostInit: function () {
                        console.log('PostInit');
                        document.getElementById('filelist').innerHTML = '';

                        document.getElementById('uploadfiles').onclick = function () {
                            uploader.start();
                            return false;
                        };
                    },

                    FilesAdded: function (up, files) {
                        console.log('FilesAdded');
                        plupload.each(files, function (file) {
                            document.getElementById('filelist').innerHTML += '<div id="' + file.id + '">' + file.name + ' (' + plupload.formatSize(file.size) + ') <b></b></div>';
                        });
                    },

                    UploadProgress: function (up, file) {
                        console.log('UploadProgress');
                        document.getElementById(file.id).getElementsByTagName('b')[0].innerHTML = '<span>' + file.percent + "%</span>";
                    },

                    Error: function (up, err) {
                        console.log('Error');
                        document.getElementById('console').innerHTML += "\nError #" + err.code + ": " + err.message;
                    },

                    UploadFile: function () {
                        console.log('UploadFile');
                    },
                    BeforeUpload: function () {
                        console.log('BeforeUpload init');
                    },
                    QueueChanged: function () {
                        console.log('QueueChanged');
                    },
                    ChunkUploaded: function () {
                        console.log('ChunkUploaded');
                    },
                    UploadComplete: function () {
                        console.log('UploadComplete');
                    }
                }
            });

            uploader.init();
        });
    </script>
</head>
<body>
    <form id="form1" runat="server">
    <div>
    <h1>
        Custom example</h1>
    <p>
        Shows you how to use the core plupload API.</p>
    <div id="filelist">
        Your browser doesn't have Flash, Silverlight or HTML5 support.</div>
    <br />
    <div id="container">
        <a id="pickfiles" href="javascript:;">[Select files]</a> <a id="uploadfiles" href="javascript:;">
            [Upload files]</a>
    </div>
    <br />
    <pre id="console"></pre>
    </div>


    <div id="plupload-upload-ui" class="hide-if-no-js">
        <div id="drag-drop-area">
            <div class="drag-drop-inside">
                <p class="drag-drop-info">Drop files here</p>
                <p>or</p>
                <p class="drag-drop-buttons">
                    <input id="plupload-browse-button" type="button" value="Select Files" class="button" />
                </p>
            </div>
        </div>
        <p class="upload-flash-bypass">
            You are using the multi-file uploader. Problems? Try the 
            <a href="http://localhost:3500/wp-admin/media-new.php?browser-uploader" target="_blank">
            browser uploader</a> 
            instead.
        </p>
    </div>


    </form>
</body>
</html>
